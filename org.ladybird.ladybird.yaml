app-id: org.ladybird.ladybird
runtime: org.kde.Platform
runtime-version: '6.8'
sdk: org.kde.Sdk
command: Ladybird
finish-args:
  - --socket=x11
  - --socket=wayland
  - --socket=pulseaudio
  - --device=dri
  - --share=ipc

modules:
  - name: ladybird
    buildsystem: simple
    build-options:
      build-args:
        - --share=network
    build-commands:
      - mkdir -p /app/bin
      - ln -s /usr/bin/ninja /app/bin/ninja-build
      - |
        cmake \
          --preset default \
          -B build \
          -S . \
          -DBUILD_SHARED_LIBS=OFF \
          -DCMAKE_BUILD_TYPE=Release \
          -DVCPKG_OVERLAY_TRIPLETS="Meta/CMake/vcpkg/distribution-triplets" \
          -DCMAKE_INSTALL_PREFIX='/app' \
          -DCMAKE_TOOLCHAIN_FILE="vcpkg/scripts/buildsystems/vcpkg.cmake" \
          -DENABLE_INSTALL_HEADERS=OFF \
          -GNinja \
          -Wno-dev
      - ninja -C build
      - ninja -C build install
      - install -Dm644 Base/res/icons/128x128/app-browser.png /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      - install -Dm644 ${FLATPAK_ID}.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 ${FLATPAK_ID}.appdata.xml /app/share/appdata/${FLATPAK_ID}.appdata.xml
      - rm /app/bin/ninja-build
    sources:
      - type: git
        url: https://github.com/LadybirdBrowser/ladybird.git
        branch: master
      - type: git
        url: https://github.com/microsoft/vcpkg.git
        commit: 74ec888e385d189b42d6b398d0bbaa6f1b1d3b0e
        dest: vcpkg
      - type: file
        path: org.ladybird.ladybird.desktop
      - type: file
        path: org.ladybird.ladybird.appdata.xml
